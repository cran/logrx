<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Generating a Log</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Generating a Log</h1>



<p><code>logrx</code> has been built with both the flexibility of code
execution and a number of different use cases in mind. While the basic
case has been outlined in our <a href="https://pharmaverse.github.io/logrx/articles/logrx.html">Get
Started</a> vignette, here we will be discussing different methods of
execution and creation of log files. These examples are meant to guide
users who wish to explore different methods of execution or for those
using <code>logrx</code> to create scripting.</p>
<div id="methods-of-execution" class="section level1">
<h1>Methods of Execution</h1>
<p>Below you will find a number of examples for different methods of
execution, these go in an increasing level of complexity and increasing
level of technical knowledge. The below examples are meant to be
starting points for those interested in using <code>logrx</code> in more
complex settings.</p>
<div id="axecute" class="section level2">
<h2><code>axecute()</code></h2>
<p>The easiest of the execution methods to use is
<code>axecute()</code>. This function can be used to execute code from
an R terminal or using command line scripts. A log is set-up around the
program, and its code is run safely and loudly (using
<code>safely()</code> from <code>{purrr}</code>).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">axecute</span>(<span class="st">&quot;my_script.R&quot;</span>)</span></code></pre></div>
</div>
<div id="log_-functions" class="section level2">
<h2><code>log_*()</code> functions</h2>
<p>The <code>log_*()</code> family of functions are the core of
<code>logrx</code> and are used internally to configure, write, and
remove the log and other objects. While these are exported functions of
the package, they are intended to be used in special cases where
<code>axecute()</code> will not work.</p>
<p>Use the <code>log_*()</code> functions to do the following:</p>
<ul>
<li><p><code>log_init()</code> to create the environment
<code>log.rx</code></p></li>
<li><p><code>log_config()</code> to add the core elements of the log to
the environment, and basic elements that are available at the time of
configuration</p></li>
<li><p><code>run_safely_loudly()</code> to execute the program code, and
capture errors, warnings, messages, output, and result. This must be
passed an executable R file to run and create the log elements
from</p></li>
<li><p><code>log_write()</code> to generate and format the log</p></li>
<li><p><code>log_remove()</code> to remove the <code>log.rx</code>
environment created by code execution</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">log_config</span>(<span class="st">&quot;my_script.R&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">run_safely_loudly</span>(<span class="st">&quot;my_script.R&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">log_write</span>()</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">log_remove</span>()</span></code></pre></div>
</div>
<div id="command-line-execution" class="section level2">
<h2>Command Line Execution</h2>
<p>While executing from an R terminal is nice if you have access to one,
you can also execute your code using system command line. This is done
using the <code>Rscript -e</code> command which executes a file using
the registered Rscript executable. Below are a few examples of how to
use the command line to execute a file and create a log as well as how
to manipulate the outputs of the execution. These are likely to be
advanced examples for most users.</p>
<p>The below chunk will run the file my_script.R and output any standard
output that is created by the execution of the file to the default
location.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">&quot;logrx::axecute(&#39;my_script.R&#39;, log_name = &#39;my_script.log&#39;, log_path = &#39;.&#39;)&quot;</span></span></code></pre></div>
<p>The below chunk will run the file <code>my_script.R</code> and output
any standard output that is created by the execution of the file to a
file called <code>temp.log</code>. This output can then later be
accessed should the user want to check the output of the file
execution.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">&quot;logrx::axecute(&#39;my_script.R&#39;, log_name = &#39;my_script.log&#39;, log_path = &#39;.&#39;)&quot;</span> <span class="op">&gt;</span> temp.log <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span></code></pre></div>
<p>The below chunk will run the file <code>my_script.R</code> and output
any standard output that is created by the execution of the file to a
file called <code>temp.log</code>. It will then take the contents of the
<code>temp.log</code> file and add those to the end of the log file
generated by the file execution and remove the temporary output log.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">&quot;logrx::axecute(&#39;my_script.R&#39;, log_name = &#39;my_script.log&#39;, log_path = &#39;.&#39;)&quot;</span> <span class="op">&gt;</span> temp.log <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span><span class="kw">;</span> <span class="fu">cat</span> my_script.log <span class="op">&gt;&gt;</span> my_script.log<span class="kw">;</span> <span class="fu">rm</span> my_script.log</span></code></pre></div>
</div>
</div>
<div id="scripting-with-logrx" class="section level1">
<h1>Scripting with <code>logrx</code></h1>
<p>While <code>logrx</code> is built around creating a log for a program
it can just as easily be used when running an entire set of programs.
The <code>axecute()</code> function has been built with both single file
execution and scripted file execution in mind. With the use of simple
functions such as <code>lapply()</code> scripting is easy. Below is some
sample code of how <code>lapply()</code> can be used with
<code>axecute()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">c</span>(<span class="st">&quot;file.R&quot;</span>, <span class="st">&quot;otherfile.R&quot;</span>), axecute)</span></code></pre></div>
<p>If your scripting needs to work on the contents of a directory
instead of a pre-defined list, functions such as <code>list.files</code>
can be used to obtain a list of files to use. Below is an example of how
this can be applied in practice by getting all files ending in
<code>.R</code> in the current working directory using a regular
expression, and then using <code>lapply()</code> to run the files using
<code>axecute()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>r_script_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.R$&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">lapply</span>(r_script_list, axecute)</span></code></pre></div>
<p>Additionally, if you need your code to run using a shell scripting
language such as bash these files can be created to run using the
previously outlined Command Line Execution examples. The above scripting
examples can be translated into a variety of different scripting
languages. Below is an example where the bash script is executed in a
directory of R files, this should execute all R files in the directory
using <code>axecute()</code> and create a corresponding set of log
files.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="cf">for</span> file <span class="kw">in</span> <span class="pp">*</span>.R<span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    <span class="bu">[</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="bu">]</span> <span class="kw">||</span> <span class="cf">continue</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    <span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">&quot;logrx::axecute(&#39;</span><span class="va">$file</span><span class="st">&#39;)&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
